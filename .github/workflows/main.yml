name: Zip&Rlz

on: push

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: zip it
        run: |
          echo "ZIMUKUX_VER=`cat addon.xml |grep  -oP 'name="ZiMuKuX" version="\K[^"]*'`" >> $GITHUB_ENV
          ver=`cat addon.xml |grep  -oP 'name="ZiMuKuX" version="\K[^"]*'`
          for file in .[^.]*; do rm -rf "$file"; done
          cd ..
          mv zimuku_for_kodi/ plugin.subtitles.zimukux/
          zip -r -qq plugin.subtitles.zimukux-$ver.zip plugin.subtitles.zimukux/
          mv plugin.subtitles.zimukux-$ver.zip plugin.subtitles.zimukux/
          mv plugin.subtitles.zimukux/ zimuku_for_kodi/ 

      - name: release
        uses: ncipollo/release-action@v1
        with:
          artifacts: "plugin.subtitles.zimukux-${{ env.ZIMUKUX_VER }}.zip"
          token: ${{ secrets.PAT_FOR_ACTIONS }}